<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ИСП-коты - Меню игры</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Подключаем Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: #2c2c2c;
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
            background-image: url('https://i.pinimg.com/736x/5a/f5/4a/5af54ad92244755cb54faeedf5d956fd.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .nickname-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .nickname-form {
            background-color: #444;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .nickname-form h2 {
            color: #bbb;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .nickname-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background-color: #555;
            border: 2px solid #666;
            border-radius: 10px;
            color: #f0f0f0;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .nickname-submit {
            background-color: #666;
            color: #f0f0f0;
            border: none;
            padding: 15px 40px;
            font-size: 1.3rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nickname-submit:hover {
            background-color: #777;
        }
        
        .game-container {
            width: 100%;
            max-width: 1200px;
            background-color: rgba(40, 40, 40, 0.85);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #555;
            display: none;
        }
        
        .header {
            background-color: #333;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #666;
            position: relative;
        }
        
        .player-info {
            position: absolute;
            top: 25px;
            right: 25px;
            background-color: #555;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.1rem;
        }
        
        .player-info span {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .game-title {
            font-size: 3.5rem;
            color: #bbb;
            text-shadow: 3px 3px 0 #000;
            letter-spacing: 2px;
        }
        
        .game-title span {
            color: #888;
        }
        
        .content-wrapper {
            display: flex;
            min-height: 700px;
        }
        
        .menu-sidebar {
            width: 250px;
            background-color: rgba(50, 50, 50, 0.9);
            padding: 20px 0;
            border-right: 2px solid #555;
        }
        
        .menu-button {
            display: block;
            width: 90%;
            margin: 10px auto;
            padding: 18px 15px;
            background-color: #666;
            color: #f0f0f0;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }
        
        .menu-button:hover {
            background-color: #777;
            transform: translateX(5px);
        }
        
        .menu-button.active {
            background-color: #888;
            box-shadow: inset 0 0 0 3px #aaa;
        }
        
        .menu-button i {
            margin-right: 12px;
            width: 25px;
            text-align: center;
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: 700px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        h2 {
            color: #bbb;
            font-size: 2.2rem;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #666;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background-color: #555;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 5px solid #888;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: #ccc;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #f0f0f0;
        }
        
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .ranking-item {
            background-color: #555;
            border-radius: 12px;
            padding: 18px 25px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        
        .ranking-item:hover {
            transform: translateY(-5px);
        }
        
        .ranking-item.current-player {
            background-color: #666;
            box-shadow: 0 0 0 3px #888;
        }
        
        .rank {
            font-size: 1.8rem;
            font-weight: bold;
            width: 60px;
            color: #ddd;
        }
        
        .player-name {
            font-size: 1.5rem;
            flex-grow: 1;
        }
        
        .player-position {
            font-size: 1.1rem;
            color: #bbb;
            background-color: #444;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .skins-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .skin-card {
            background-color: #555;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            position: relative;
        }
        
        .skin-card:hover {
            transform: scale(1.05);
            background-color: #5a5a5a;
        }
        
        .skin-card.owned {
            background-color: #4a5a4a;
            border: 2px solid #6ca86c;
        }
        
        .skin-card.locked {
            opacity: 0.7;
            filter: grayscale(30%);
        }
        
        .skin-card.selected {
            border: 3px solid #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }
        
        .skin-image {
            width: 120px;
            height: 120px;
            background-color: #777;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border: 3px solid #888;
        }
        
        .skin-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .skin-name {
            font-size: 1rem;
            text-align: center;
            margin-bottom: 10px;
            color: #f0f0f0;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .skin-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffcc00;
            background-color: #444;
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .skin-price.free {
            color: #4CAF50;
        }
        
        .coin-icon {
            color: gold;
        }
        
        .skin-status {
            margin-top: 5px;
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .skin-status.owned {
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .skin-status.locked {
            color: #ff9800;
            background-color: rgba(255, 152, 0, 0.2);
        }
        
        .feedback-form {
            max-width: 800px;
            margin: 0 auto;
            background-color: #555;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.2rem;
            color: #ddd;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 15px;
            background-color: #666;
            border: 2px solid #777;
            border-radius: 10px;
            color: #f0f0f0;
            font-size: 1.1rem;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .submit-btn {
            background-color: #666;
            color: #f0f0f0;
            border: none;
            padding: 18px 40px;
            font-size: 1.3rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
        }
        
        .submit-btn:hover {
            background-color: #777;
            transform: translateY(-3px);
        }
        
        .main-screen {
            text-align: center;
            padding-top: 50px;
        }
        
        .game-logo {
            font-size: 5rem;
            color: #bbb;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #000;
        }
        
        .game-description {
            font-size: 1.2rem;
            color: #bbb;
            max-width: 700px;
            margin: 0 auto 30px;
            padding: 20px;
            background-color: rgba(85, 85, 85, 0.5);
            border-radius: 10px;
            line-height: 1.5;
        }
        
        .play-button {
            background-color: #666;
            color: #f0f0f0;
            border: none;
            padding: 25px 60px;
            font-size: 2.2rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 #555;
        }
        
        .play-button:hover {
            background-color: #777;
            transform: translateY(-5px);
            box-shadow: 0 12px 0 #555;
        }
        
        .play-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 0 #555;
        }
        
        @media (max-width: 900px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .menu-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #555;
            }
            
            .menu-button {
                width: 95%;
                margin: 5px auto;
            }
            
            .player-info {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
                display: inline-block;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .skins-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        @media (max-width: 600px) {
            .game-title {
                font-size: 2.5rem;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .skins-container {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .skin-image {
                width: 100px;
                height: 100px;
            }
            
            .nickname-form {
                padding: 20px;
            }
        }
        
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #444;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background-color: #f44336;
        }
        
        .notification.info {
            background-color: #2196F3;
        }
        
        .game-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #2c2c2c;
            z-index: 2000;
            overflow: hidden;
        }
        
        .game-header {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }
        
        .score-display {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .game-canvas-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .pause-btn {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        .game-over-content {
            background-color: #444;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 500px;
        }
        
        .game-over-title {
            color: #ff5555;
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .game-over-score {
            font-size: 2.5rem;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .game-over-coins {
            font-size: 1.8rem;
            color: gold;
            margin-bottom: 20px;
        }
        
        .game-over-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .restart-btn, .menu-btn {
            padding: 15px 30px;
            font-size: 1.3rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .restart-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .menu-btn {
            background-color: #666;
            color: white;
        }
        
        .restart-btn:hover, .menu-btn:hover {
            transform: scale(1.05);
        }
        
        .current-skin-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            max-width: 150px;
            text-align: center;
            z-index: 10;
        }
        
        .skin-in-game {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 5px;
            border: 2px solid #ffcc00;
        }
        
        .skin-in-game img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .exit-game-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            z-index: 10;
        }
        
        .coin-display {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .coins-earned {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: gold;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            display: none;
            align-items: center;
            gap: 5px;
            animation: coinPopup 1s ease;
        }
        
        @keyframes coinPopup {
            0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            50% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        .coins-count {
            position: absolute;
            top: 25px;
            left: 25px;
            background-color: #555;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .coins-count span {
            color: gold;
            font-weight: bold;
        }
        
        .coin-icon-large {
            color: gold;
            font-size: 1.3rem;
        }
        
        .speed-display {
            position: absolute;
            top: 60px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        /* Стили для кнопки авторизации через Telegram */
        .telegram-auth-btn {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px auto;
            transition: all 0.3s ease;
        }
        
        .telegram-auth-btn:hover {
            background-color: #0077b5;
            transform: translateY(-2px);
        }
        
        .telegram-user-info {
            background-color: rgba(0, 136, 204, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #0088cc;
        }
    </style>
</head>
<body>
    <div class="nickname-modal" id="nicknameModal">
        <div class="nickname-form">
            <h2>Введите ваш игровой ник</h2>
            <input type="text" id="nicknameInput" class="nickname-input" placeholder="Ваш никнейм" maxlength="20">
            <button class="nickname-submit" id="nicknameSubmit">Начать игру</button>
            
            <!-- Кнопка авторизации через Telegram (если не в WebApp) -->
            <div id="telegramAuthSection" style="margin-top: 20px; display: none;">
                <div style="color: #bbb; margin-bottom: 10px;">Или войдите через Telegram:</div>
                <button class="telegram-auth-btn" id="telegramAuthBtn">
                    <i class="fab fa-telegram"></i> Войти через Telegram
                </button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="game-container" id="gameContainer">
        <div class="header">
            <h1 class="game-title">ИСП<span>-коты</span></h1>
            <div class="coins-count" id="coinsCount">
                <i class="fas fa-coins coin-icon-large"></i>
                <span id="coinsAmount">0</span> монеток
            </div>
            <div class="player-info">
                Игрок: <span id="currentPlayerName">Гость</span>
                <div id="telegramBadge" style="display: none; font-size: 0.8rem; color: #0088cc; margin-top: 5px;">
                    <i class="fab fa-telegram"></i> Telegram
                </div>
            </div>
        </div>
        
        <div class="content-wrapper">
            <div class="menu-sidebar">
                <button class="menu-button active" data-tab="main">
                    <i class="fas fa-home"></i>Главная
                </button>
                <button class="menu-button" data-tab="stats">
                    <i class="fas fa-chart-bar"></i>Статистика
                </button>
                <button class="menu-button" data-tab="rating">
                    <i class="fas fa-trophy"></i>Рейтинг
                </button>
                <button class="menu-button" data-tab="skins">
                    <i class="fas fa-user-circle"></i>Скины
                </button>
                <button class="menu-button" data-tab="feedback">
                    <i class="fas fa-comment-alt"></i>Отзыв
                </button>
            </div>
            
            <div class="content-area">
                <div id="main" class="tab-content active">
                    <div class="main-screen">
                        <div class="game-logo">
                            <i class="fas fa-cat"></i>
                        </div>
                        <div class="game-description">
                            Для удобной игры переверните экран!!! Управляйте котом нажатием на экран, прыгайте, собирайте очки. (За каждые 100 очков получайте 1 монетку)
                        </div>
                        <button class="play-button" id="startGameBtn">
                            НАЧАТЬ ИГРУ
                        </button>
                    </div>
                </div>
                
                <div id="stats" class="tab-content">
                    <h2><i class="fas fa-chart-bar"></i> Статистика</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Всего сыграно игр</div>
                            <div class="stat-value" id="totalGames">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Лучший результат</div>
                            <div class="stat-value" id="bestScore">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Всего набрано очков</div>
                            <div class="stat-value" id="totalPoints">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Всего прыжков</div>
                            <div class="stat-value" id="totalJumps">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Средний результат</div>
                            <div class="stat-value" id="averageScore">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Открыто скинов</div>
                            <div class="stat-value" id="openedSkins">1/32</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Накоплено монеток</div>
                            <div class="stat-value" id="totalCoins">0</div>
                        </div>
                    </div>
                </div>
                
                <div id="rating" class="tab-content">
                    <h2><i class="fas fa-trophy"></i> Рейтинг игроков</h2>
                    <div class="ranking-list" id="rankingList">
                    </div>
                </div>
                
                <div id="skins" class="tab-content">
                    <h2><i class="fas fa-user-circle"></i> Коллекция скинов</h2>
                    <p style="margin-bottom: 20px; font-size: 1.2rem; color: #bbb; text-align: center;">
                        У вас есть: <span id="coinsForSkins" style="color: gold; font-weight: bold;">0</span> монеток
                    </p>
                    <div class="skins-container" id="skinsContainer">
                    </div>
                </div>
                
                <div id="feedback" class="tab-content">
                    <h2><i class="fas fa-comment-alt"></i> Оставить отзыв</h2>
                    
                    <!-- Информация о пользователе Telegram -->
                    <div class="telegram-user-info" id="telegramUserInfo" style="display: none;">
                        <i class="fab fa-telegram" style="color: #0088cc; font-size: 2rem; margin-bottom: 10px;"></i>
                        <div id="telegramUserName"></div>
                        <div style="font-size: 0.9rem; color: #aaa; margin-top: 5px;">
                            Ваш отзыв будет отправлен разработчику через Telegram
                        </div>
                    </div>
                    
                    <div class="feedback-form">
                        <div class="form-group">
                            <label for="name">Ваше имя:</label>
                            <input type="text" id="name" placeholder="Введите ваше имя">
                        </div>
                        <div class="form-group">
                            <label for="rating">Оценка игры:</label>
                            <select id="rating-select">
                                <option value="5">Отлично (5 звёзд)</option>
                                <option value="4">Хорошо (4 звезды)</option>
                                <option value="3" selected>Удовлетворительно (3 звезды)</option>
                                <option value="2">Плохо (2 звезды)</option>
                                <option value="1">Ужасно (1 звезда)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">Ваш отзыв:</label>
                            <textarea id="message" placeholder="Расскажите о вашем опыте игры, предложите улучшения или сообщите об ошибках..."></textarea>
                        </div>
                        <button class="submit-btn" id="feedbackSubmit">Отправить отзыв</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="game-screen" id="gameScreen">
        <button class="exit-game-btn" id="exitGameBtn">
            <i class="fas fa-times"></i>
        </button>
        <div class="game-header">
            <div class="score-display">
                Очки: <span id="currentScore">0</span>
            </div>
            <div class="coin-display" id="coinDisplay">
                <i class="fas fa-coins coin-icon"></i>
                <span id="currentCoins">0</span>
            </div>
            <button class="pause-btn" id="pauseBtn">
                <i class="fas fa-pause"></i>
            </button>
        </div>
        
        <div class="speed-display" id="speedDisplay">
            Скорость: <span id="currentSpeed">5</span>
        </div>
        
        <div class="coins-earned" id="coinsEarned">
            <i class="fas fa-coins"></i>
            +1 монетка!
        </div>
        
        <div class="current-skin-indicator" id="currentSkinIndicator">
            <div class="skin-in-game">
                <img id="currentSkinImage" src="" alt="Текущий скин">
            </div>
            <div id="currentSkinName">Текущий скин</div>
        </div>
        
        <div class="game-canvas-container">
            <canvas id="gameCanvas"></canvas>
        </div>
        
        <div class="game-over-screen" id="gameOverScreen">
            <div class="game-over-content">
                <h2 class="game-over-title">ИГРА ОКОНЧЕНА!</h2>
                <div class="game-over-score" id="finalScore">Очки: 0</div>
                <div class="game-over-coins" id="finalCoins">Заработано монеток: 0</div>
                <div class="game-over-buttons">
                    <button class="restart-btn" id="restartBtn">
                        <i class="fas fa-redo"></i> Играть снова
                    </button>
                    <button class="menu-btn" id="menuBtn">
                        <i class="fas fa-home"></i> В меню
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let playerName = "Гость";
        let playerStats = {
            totalGames: 0,
            bestScore: 0,
            totalPoints: 0,
            totalJumps: 0,
            openedSkins: 1,
            unlockedSkins: [0],
            selectedSkin: 0,
            coins: 0,
            coinsEarned: 0,
            lastCoinScore: 0
        };
        
        let game = {
            canvas: null,
            ctx: null,
            width: 0,
            height: 0,
            running: false,
            score: 0,
            gameSpeed: 5,
            baseSpeed: 5,
            gravity: 0.5,
            jumpForce: -15,
            isPaused: false,
            player: {
                x: 100,
                y: 0,
                width: 80,
                height: 80,
                velocityY: 0,
                isJumping: false,
                skinIndex: 0
            },
            ground: {
                x: 0,
                y: 0,
                width: 0,
                height: 100
            },
            obstacles: [],
            clouds: [],
            lastObstacleTime: 0,
            obstacleInterval: 2000,
            lastCloudTime: 0,
            cloudInterval: 3000,
            jumpCount: 0,
            lastScoreUpdate: 0,
            scoreUpdateInterval: 50,
            distanceTraveled: 0
        };
        
        // Переменные для Telegram WebApp
        let isTelegramWebApp = false;
        let telegramUser = null;
        let webAppInitialized = false;
        
        const skinNames = [
            "Мелиса Агзамова", "Гульсия Аминева", "Даниил Бадранов", "Данил Байсламов", 
            "Настя Батыршина", "Илхан Бикбулатов", "Юлдаш Габбасов", "Булат Габсабиров",
            "Данил Газизов", "Азалия Зайнулина", "Милана Имашева", "Регина Казбакова", 
            "Артем Мазин", "Салия Мухаметова", "София Мухаметдинова", "Арслан Махмутов",
            "Лилия Мигранова", "Залина Петрова", "Радмир Саитбаталов", "Арслан Сайфутдинов", 
            "Софья Сахарчук", "Даша Сиухова", "Аня Соболева", "Никита Степанов", 
            "Тимур Тартыков", "Диана Халикова", "Илнур Хасанов", "Илназ Хасанов", 
            "Тамила Хисамова", "Рамина Юмакаева", "Адэля Ямаева", "Айдар Ришатович"
        ];
        
        const skinImages = [
            'https://i.postimg.cc/7PC50wPD/IMG-0709.png',
            'https://i.postimg.cc/HsgTngrD/IMG-0745.png',
            'https://i.postimg.cc/3NHQkXJq/IMG-0688.png',
            'https://i.postimg.cc/Mprk72pR/IMG-0757.png',
            'https://i.postimg.cc/2yYgkC0D/IMG-0697.png',
            'https://i.postimg.cc/sXzvrhC2/IMG-0703.png',
            'https://i.postimg.cc/bJqNMf1N/IMG-0715.png',
            'https://i.postimg.cc/L8f988T5/IMG-0727.png',
            'https://i.postimg.cc/vZWydSYF/IMG-0754.png',
            'https://i.postimg.cc/63qFTHXT/IMG-0775.png',
            'https://i.postimg.cc/zB95Nmg5/IMG-0730.png',
            'https://i.postimg.cc/L8HS23nh/IMG-0736.png',
            'https://i.postimg.cc/gJ6FNMT0/IMG-0706.png',
            'https://i.postimg.cc/8zk2qk0M/IMG-0739.png',
            'https://i.postimg.cc/PxD9mCCh/IMG-0700.png',
            'https://i.postimg.cc/tgKmC9Bq/IMG-0712.png',
            'https://i.postimg.cc/ydCvCv8t/IMG-0721.png',
            'https://i.postimg.cc/NMx7qtV6/IMG-0685.png',
            'https://i.postimg.cc/pLnfVz4Y/IMG-0742.png',
            'https://i.postimg.cc/B6JHCy6g/IMG-0682.png',
            'https://i.postimg.cc/02zmZ78c/IMG-0718.png',
            'https://i.postimg.cc/R0LnqRRF/IMG-0772.png',
            'https://i.postimg.cc/vZW4SzCm/IMG-0763.png',
            'https://i.postimg.cc/0jTNVMfc/IMG-0691.png',
            'https://i.postimg.cc/YSrCDw6w/IMG-0769.png',
            'https://i.postimg.cc/ZnCcrg7g/IMG-0733.png',
            'https://i.postimg.cc/W346vCvj/IMG-0751.png',
            'https://i.postimg.cc/vHn7b5pf/IMG-0748.png',
            'https://i.postimg.cc/JhrjNvtt/IMG-0766.png',
            'https://i.postimg.cc/SRM9Qp1Z/IMG-0724.png',
            'https://i.postimg.cc/qMKX1Kr5/IMG-0694.png',
            'https://i.postimg.cc/MTX1VMtZ/IMG-0760.png'
        ];
        
        const obstacleImages = [
            'https://i.postimg.cc/X7TFhhzP/zagruzennoe-(4).png',
            'https://i.postimg.cc/mkkCfG4j/zagruzennoe-(3).png',
            'https://i.postimg.cc/Cx3NGd0d/zagruzennoe-(6).png',
            'https://i.postimg.cc/x1cxGWbG/zagruzennoe-(5).png'
        ];
        
        const images = {
            sky: new Image(),
            ground: new Image(),
            player: [],
            obstacles: []
        };
        
        images.sky.src = 'https://i.postimg.cc/FRtrm1z8/photo-4-2026-01-05-14-51-52.jpg';
        images.ground.src = 'https://i.postimg.cc/d35c70QV/photo-1-2026-01-06-20-37-31.jpg';
        
        skinImages.forEach(src => {
            const img = new Image();
            img.src = src;
            images.player.push(img);
        });
        
        obstacleImages.forEach(src => {
            const img = new Image();
            img.src = src;
            images.obstacles.push(img);
        });
        
        // Инициализация Telegram WebApp
        function initTelegramWebApp() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                isTelegramWebApp = true;
                
                try {
                    // Инициализируем WebApp
                    Telegram.WebApp.ready();
                    webAppInitialized = true;
                    
                    // Расширяем WebApp на весь экран
                    Telegram.WebApp.expand();
                    
                    // Получаем данные пользователя
                    telegramUser = Telegram.WebApp.initDataUnsafe.user;
                    
                    if (telegramUser) {
                        // Автоматически устанавливаем имя из Telegram
                        const telegramName = telegramUser.first_name + 
                                            (telegramUser.last_name ? ' ' + telegramUser.last_name : '');
                        document.getElementById('nicknameInput').value = telegramName;
                        
                        // Показываем бейдж Telegram
                        document.getElementById('telegramBadge').style.display = 'block';
                        
                        // Заполняем имя в форме отзыва
                        document.getElementById('name').value = telegramName;
                        
                        // Показываем информацию о пользователе в форме отзыва
                        const userInfoDiv = document.getElementById('telegramUserInfo');
                        const userNameDiv = document.getElementById('telegramUserName');
                        
                        userInfoDiv.style.display = 'block';
                        let userText = `<strong>${telegramName}</strong>`;
                        if (telegramUser.username) {
                            userText += ` (@${telegramUser.username})`;
                        }
                        userNameDiv.innerHTML = userText;
                        
                        // Прячем кнопку авторизации через Telegram
                        document.getElementById('telegramAuthSection').style.display = 'none';
                        
                        showNotification(`Добро пожаловать, ${telegramName}!`, 'info');
                    }
                    
                    // Меняем тему под Telegram
                    if (Telegram.WebApp.colorScheme === 'dark') {
                        document.body.style.backgroundColor = '#1a1a1a';
                    }
                    
                } catch (error) {
                    console.error('Ошибка инициализации Telegram WebApp:', error);
                    isTelegramWebApp = false;
                }
            } else {
                console.log('Telegram WebApp не обнаружен, показываем кнопку авторизации');
                // Показываем кнопку авторизации через Telegram
                document.getElementById('telegramAuthSection').style.display = 'block';
                
                // Обработчик кнопки авторизации
                document.getElementById('telegramAuthBtn').addEventListener('click', function() {
                    showNotification('Для авторизации запустите игру через Telegram бота', 'info');
                });
            }
        }
        
        // Основная инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализируем Telegram WebApp
            initTelegramWebApp();
            
            // Загружаем данные игры
            loadGameData();
            
            // Обработка ввода ника
            document.getElementById('nicknameSubmit').addEventListener('click', function() {
                const nicknameInput = document.getElementById('nicknameInput').value.trim();
                
                if (nicknameInput === '') {
                    showNotification('Пожалуйста, введите ваш никнейм!', 'error');
                    return;
                }
                
                playerName = nicknameInput;
                document.getElementById('currentPlayerName').textContent = playerName;
                
                document.getElementById('nicknameModal').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                
                loadPlayerDataFromServer();
                saveGameData();
                generateRanking();
                generateSkins();
                
                showNotification(`Добро пожаловать, ${playerName}!`, 'info');
            });
            
            document.getElementById('nicknameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('nicknameSubmit').click();
                }
            });
        });
        
        // Функция для показа уведомлений
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Загрузка и сохранение данных игры
        function loadGameData() {
            const savedName = localStorage.getItem('ispCatsPlayerName');
            const savedStats = localStorage.getItem('ispCatsPlayerStats');
            
            if (savedName) {
                playerName = savedName;
                document.getElementById('nicknameInput').value = playerName;
            }
            
            if (savedStats) {
                const parsedStats = JSON.parse(savedStats);
                playerStats = parsedStats;
                
                if (!playerStats.unlockedSkins) {
                    playerStats.unlockedSkins = [];
                    for (let i = 0; i < playerStats.openedSkins && i < 31; i++) {
                        playerStats.unlockedSkins.push(i);
                    }
                }
                
                if (!playerStats.selectedSkin) {
                    playerStats.selectedSkin = 0;
                }
                
                if (!playerStats.coins) {
                    playerStats.coins = 0;
                }
                
                if (!playerStats.lastCoinScore) {
                    playerStats.lastCoinScore = 0;
                }
                
                updateStatsDisplay();
            }
        }
        
        function saveGameData() {
            localStorage.setItem('ispCatsPlayerName', playerName);
            localStorage.setItem('ispCatsPlayerStats', JSON.stringify(playerStats));
            savePlayerDataToServer();
        }
        
        function savePlayerDataToServer() {
            const serverData = {
                playerName: playerName,
                playerStats: playerStats,
                timestamp: new Date().getTime()
            };
            
            try {
                localStorage.setItem('ispCatsServerData_' + playerName, JSON.stringify(serverData));
            } catch (e) {
                console.log('Ошибка сохранения на сервер:', e);
            }
        }
        
        function loadPlayerDataFromServer() {
            try {
                const savedData = localStorage.getItem('ispCatsServerData_' + playerName);
                if (savedData) {
                    const serverData = JSON.parse(savedData);
                    if (serverData.playerName === playerName) {
                        playerStats = serverData.playerStats;
                        updateStatsDisplay();
                        showNotification('Прогресс загружен!', 'info');
                    }
                }
            } catch (e) {
                console.log('Ошибка загрузки с сервера:', e);
            }
        }
        
        function updateStatsDisplay() {
            document.getElementById('totalGames').textContent = playerStats.totalGames;
            document.getElementById('bestScore').textContent = playerStats.bestScore.toLocaleString();
            document.getElementById('totalPoints').textContent = playerStats.totalPoints.toLocaleString();
            document.getElementById('totalJumps').textContent = playerStats.totalJumps.toLocaleString();
            document.getElementById('averageScore').textContent = playerStats.totalGames > 0 ? 
                Math.floor(playerStats.totalPoints / playerStats.totalGames).toLocaleString() : "0";
            document.getElementById('openedSkins').textContent = playerStats.unlockedSkins.length + "/32";
            document.getElementById('totalCoins').textContent = playerStats.coins;
            document.getElementById('coinsAmount').textContent = playerStats.coins;
            document.getElementById('coinsForSkins').textContent = playerStats.coins;
            playerStats.openedSkins = playerStats.unlockedSkins.length;
        }
        
        function generateRanking() {
            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = '';
            
            let allPlayers = [];
            
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('ispCatsServerData_')) {
                        const data = localStorage.getItem(key);
                        if (data) {
                            const playerData = JSON.parse(data);
                            if (playerData.playerName && playerData.playerStats) {
                                allPlayers.push({
                                    name: playerData.playerName,
                                    score: playerData.playerStats.bestScore,
                                    coins: playerData.playerStats.coins,
                                    isCurrentPlayer: playerData.playerName === playerName
                                });
                            }
                        }
                    }
                }
            } catch (e) {
                console.log('Ошибка загрузки рейтинга:', e);
            }
            
            if (allPlayers.length === 0) {
                allPlayers = [
                    { name: "Кот-чемпион", score: 15420, coins: 154, isCurrentPlayer: false },
                    { name: "Усатый прыгун", score: 13250, coins: 132, isCurrentPlayer: false },
                    { name: "Мурзик", score: 12480, coins: 124, isCurrentPlayer: false },
                    { name: "Рыжик", score: 11890, coins: 118, isCurrentPlayer: false },
                    { name: "Барсик", score: 11230, coins: 112, isCurrentPlayer: false },
                    { name: "Снежок", score: 10560, coins: 105, isCurrentPlayer: false }
                ];
                
                if (!allPlayers.find(p => p.name === playerName)) {
                    allPlayers.push({ 
                        name: playerName, 
                        score: playerStats.bestScore, 
                        coins: playerStats.coins, 
                        isCurrentPlayer: true 
                    });
                }
            }
            
            allPlayers.sort((a, b) => b.score - a.score);
            
            allPlayers.forEach((player, index) => {
                const rankingItem = document.createElement('div');
                rankingItem.className = `ranking-item ${player.isCurrentPlayer ? 'current-player' : ''}`;
                
                let placeText = "";
                if (index === 0) placeText = "🥇 1 место";
                else if (index === 1) placeText = "🥈 2 место";
                else if (index === 2) placeText = "🥉 3 место";
                else placeText = `${index + 1} место`;
                
                rankingItem.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="player-name">${player.name}</div>
                    <div class="player-position">${placeText} | ${player.score.toLocaleString()} очков | ${player.coins} монеток</div>
                `;
                
                rankingList.appendChild(rankingItem);
            });
        }
        
        function checkForCoinReward() {
            const coinsFromScore = Math.floor(game.score / 100);
            
            if (coinsFromScore > playerStats.coinsEarned) {
                const newCoins = coinsFromScore - playerStats.coinsEarned;
                playerStats.coinsEarned = coinsFromScore;
                
                showCoinEarnedAnimation();
                
                return newCoins;
            }
            
            return 0;
        }
        
        function showCoinEarnedAnimation() {
            const coinsEarned = document.getElementById('coinsEarned');
            coinsEarned.style.display = 'flex';
            
            setTimeout(() => {
                coinsEarned.style.display = 'none';
            }, 1000);
        }
        
        function unlockSkinWithCoins(skinIndex, price) {
            if (playerStats.coins >= price) {
                playerStats.coins -= price;
                
                if (!playerStats.unlockedSkins.includes(skinIndex)) {
                    playerStats.unlockedSkins.push(skinIndex);
                    playerStats.unlockedSkins.sort((a, b) => a - b);
                }
                
                playerStats.selectedSkin = skinIndex;
                
                saveGameData();
                updateStatsDisplay();
                generateSkins();
                
                if (game.running) {
                    updateCurrentSkinDisplay();
                }
                
                return true;
            }
            return false;
        }
        
        function selectSkin(skinIndex) {
            if (playerStats.unlockedSkins.includes(skinIndex)) {
                playerStats.selectedSkin = skinIndex;
                saveGameData();
                generateSkins();
                
                if (game.running) {
                    updateCurrentSkinDisplay();
                }
                
                return true;
            }
            return false;
        }
        
        function generateSkins() {
            const skinsContainer = document.getElementById('skinsContainer');
            skinsContainer.innerHTML = '';
            
            const skinPrices = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 750];
            
            skinNames.forEach((name, index) => {
                const skinCard = document.createElement('div');
                const price = skinPrices[index];
                const isOwned = playerStats.unlockedSkins.includes(index);
                const isLocked = !isOwned;
                const isSelected = playerStats.selectedSkin === index;
                
                skinCard.className = `skin-card ${isOwned ? 'owned' : ''} ${isLocked ? 'locked' : ''} ${isSelected ? 'selected' : ''}`;
                
                let displayName = name;
                let displayImage = skinImages[index];
                let displayStyle = '';
                
                if (index === 31 && !isOwned) {
                    displayName = "???";
                    displayStyle = 'filter: brightness(0.1) blur(2px);';
                }
                
                skinCard.innerHTML = `
                    <div class="skin-image">
                        <img src="${displayImage}" alt="${displayName}" title="${displayName}" 
                             style="${displayStyle}" 
                             onerror="this.src='https://placekitten.com/120/120?image=${index+1}'">
                    </div>
                    <div class="skin-name">${displayName}</div>
                    <div class="skin-price ${price === 0 ? 'free' : ''}">
                        ${price === 0 ? 'Бесплатно' : `<i class="fas fa-coins coin-icon"></i>${price} монеток`}
                    </div>
                    <div class="skin-status ${isOwned ? 'owned' : 'locked'}">
                        ${isOwned ? (isSelected ? '✓ Выбран' : '✓ Открыт') : 'Не открыт'}
                    </div>
                `;
                
                skinCard.addEventListener('click', function() {
                    if (isOwned) {
                        if (selectSkin(index)) {
                            showNotification(`Скин "${name}" выбран!`, 'info');
                        }
                    } else {
                        if (price === 0) {
                            if (!playerStats.unlockedSkins.includes(index)) {
                                playerStats.unlockedSkins.push(index);
                                playerStats.unlockedSkins.sort((a, b) => a - b);
                            }
                            selectSkin(index);
                            saveGameData();
                            updateStatsDisplay();
                            generateSkins();
                            showNotification(`Скин "${name}" успешно открыт и выбран!`, 'info');
                        } else {
                            if (unlockSkinWithCoins(index, price)) {
                                showNotification(`Поздравляем! Вы купили скин "${name}" за ${price} монеток!`, 'info');
                            } else {
                                showNotification(`Недостаточно монеток! Нужно: ${price}, у вас: ${playerStats.coins}`, 'error');
                            }
                        }
                    }
                });
                
                skinsContainer.appendChild(skinCard);
            });
        }
        
        // Обработка переключения вкладок
        document.querySelectorAll('.menu-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.menu-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                this.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                if (tabId === 'rating') {
                    generateRanking();
                }
                
                if (tabId === 'skins') {
                    generateSkins();
                }
            });
        });
        
        // ИГРОВАЯ ЛОГИКА
        
        function initGame() {
            game.canvas = document.getElementById('gameCanvas');
            game.ctx = game.canvas.getContext('2d');
            
            game.width = window.innerWidth;
            game.height = window.innerHeight;
            game.canvas.width = game.width;
            game.canvas.height = game.height;
            
            game.player.skinIndex = playerStats.selectedSkin;
            game.player.y = game.height - game.player.height - 100;
            game.player.velocityY = 0;
            game.player.isJumping = false;
            
            game.ground.y = game.height - 100;
            game.ground.width = game.width;
            game.ground.height = 100;
            
            game.score = 0;
            game.distanceTraveled = 0;
            playerStats.coinsEarned = 0;
            playerStats.lastCoinScore = 0;
            game.gameSpeed = 5;
            game.baseSpeed = 5;
            game.obstacles = [];
            game.clouds = [];
            game.lastObstacleTime = Date.now();
            game.lastCloudTime = Date.now();
            game.lastScoreUpdate = Date.now();
            game.jumpCount = 0;
            game.running = true;
            game.isPaused = false;
            
            document.getElementById('currentScore').textContent = game.score;
            document.getElementById('currentCoins').textContent = playerStats.coins;
            document.getElementById('currentSpeed').textContent = game.gameSpeed.toFixed(1);
            
            updateCurrentSkinDisplay();
            
            gameLoop();
        }
        
        function updateCurrentSkinDisplay() {
            const skinIndex = playerStats.selectedSkin;
            let skinName = skinNames[skinIndex];
            let skinImage = skinImages[skinIndex];
            
            if (skinIndex === 31 && !playerStats.unlockedSkins.includes(31)) {
                skinName = "???";
            }
            
            document.getElementById('currentSkinName').textContent = skinName;
            document.getElementById('currentSkinImage').src = skinImage;
        }
        
        function createObstacle() {
            const obstacleTypes = [
                { width: 60, height: 80, type: 0 },
                { width: 70, height: 70, type: 1 },
                { width: 80, height: 60, type: 2 },
                { width: 90, height: 70, type: 3 }
            ];
            
            const type = Math.floor(Math.random() * obstacleTypes.length);
            const obstacle = {
                x: game.width,
                y: game.ground.y - obstacleTypes[type].height,
                width: obstacleTypes[type].width,
                height: obstacleTypes[type].height,
                type: obstacleTypes[type].type
            };
            
            game.obstacles.push(obstacle);
        }
        
        function createCloud() {
            const cloud = {
                x: game.width,
                y: Math.random() * (game.height / 3) + 50,
                width: 100 + Math.random() * 100,
                height: 60 + Math.random() * 40,
                speed: 1 + Math.random() * 2
            };
            
            game.clouds.push(cloud);
        }
        
        function updateGame() {
            if (game.isPaused || !game.running) return;
            
            const currentTime = Date.now();
            
            game.player.velocityY += game.gravity;
            game.player.y += game.player.velocityY;
            
            if (game.player.y > game.ground.y - game.player.height) {
                game.player.y = game.ground.y - game.player.height;
                game.player.velocityY = 0;
                game.player.isJumping = false;
            }
            
            if (currentTime - game.lastObstacleTime > game.obstacleInterval) {
                createObstacle();
                game.lastObstacleTime = currentTime;
                
                game.obstacleInterval = Math.max(800, 2000 - game.score * 0.01);
            }
            
            if (currentTime - game.lastCloudTime > game.cloudInterval) {
                createCloud();
                game.lastCloudTime = currentTime;
            }
            
            for (let i = game.obstacles.length - 1; i >= 0; i--) {
                game.obstacles[i].x -= game.gameSpeed;
                
                if (
                    game.player.x < game.obstacles[i].x + game.obstacles[i].width &&
                    game.player.x + game.player.width > game.obstacles[i].x &&
                    game.player.y < game.obstacles[i].y + game.obstacles[i].height &&
                    game.player.y + game.player.height > game.obstacles[i].y
                ) {
                    gameOver();
                    return;
                }
                
                if (game.obstacles[i].x + game.obstacles[i].width < 0) {
                    game.obstacles.splice(i, 1);
                }
            }
            
            for (let i = game.clouds.length - 1; i >= 0; i--) {
                game.clouds[i].x -= game.clouds[i].speed;
                
                if (game.clouds[i].x + game.clouds[i].width < 0) {
                    game.clouds.splice(i, 1);
                }
            }
            
            game.gameSpeed = game.baseSpeed + Math.floor(game.score / 100) * 0.1;
            
            document.getElementById('currentSpeed').textContent = game.gameSpeed.toFixed(1);
            
            if (currentTime - game.lastScoreUpdate > game.scoreUpdateInterval) {
                const distancePerUpdate = game.gameSpeed * (game.scoreUpdateInterval / 1000) * 10;
                game.distanceTraveled += distancePerUpdate;
                
                const scoreToAdd = Math.floor(game.distanceTraveled) - game.score;
                if (scoreToAdd > 0) {
                    game.score += scoreToAdd;
                    document.getElementById('currentScore').textContent = game.score;
                    
                    const newCoins = checkForCoinReward();
                    if (newCoins > 0) {
                        playerStats.coins += newCoins;
                        document.getElementById('currentCoins').textContent = playerStats.coins;
                    }
                }
                
                game.lastScoreUpdate = currentTime;
            }
        }
        
        function drawGame() {
            game.ctx.clearRect(0, 0, game.width, game.height);
            
            if (images.sky.complete) {
                game.ctx.drawImage(images.sky, 0, 0, game.width, game.height);
            } else {
                game.ctx.fillStyle = '#87CEEB';
                game.ctx.fillRect(0, 0, game.width, game.height);
            }
            
            game.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            game.clouds.forEach(cloud => {
                game.ctx.beginPath();
                game.ctx.ellipse(cloud.x + cloud.width/4, cloud.y + cloud.height/3, cloud.width/4, cloud.height/3, 0, 0, Math.PI * 2);
                game.ctx.ellipse(cloud.x + cloud.width/2, cloud.y + cloud.height/4, cloud.width/4, cloud.height/3, 0, 0, Math.PI * 2);
                game.ctx.ellipse(cloud.x + cloud.width*3/4, cloud.y + cloud.height/3, cloud.width/4, cloud.height/3, 0, 0, Math.PI * 2);
                game.ctx.fill();
            });
            
            if (images.ground.complete) {
                game.ctx.drawImage(images.ground, 0, game.ground.y, game.width, game.ground.height);
            } else {
                game.ctx.fillStyle = '#8B4513';
                game.ctx.fillRect(0, game.ground.y, game.width, game.ground.height);
            }
            
            game.obstacles.forEach(obstacle => {
                if (images.obstacles[obstacle.type] && images.obstacles[obstacle.type].complete) {
                    game.ctx.drawImage(
                        images.obstacles[obstacle.type], 
                        obstacle.x, 
                        obstacle.y, 
                        obstacle.width, 
                        obstacle.height
                    );
                } else {
                    game.ctx.fillStyle = '#8B0000';
                    game.ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    
                    game.ctx.fillStyle = '#FF0000';
                    game.ctx.fillRect(obstacle.x + 5, obstacle.y + 5, obstacle.width - 10, obstacle.height - 10);
                }
            });
            
            const skinIndex = game.player.skinIndex;
            if (images.player[skinIndex] && images.player[skinIndex].complete) {
                game.ctx.drawImage(
                    images.player[skinIndex],
                    game.player.x,
                    game.player.y,
                    game.player.width,
                    game.player.height
                );
            } else {
                game.ctx.fillStyle = '#FFA500';
                game.ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
                
                game.ctx.fillStyle = 'white';
                game.ctx.fillRect(game.player.x + 15, game.player.y + 15, 15, 15);
                game.ctx.fillRect(game.player.x + 50, game.player.y + 15, 15, 15);
                
                game.ctx.fillStyle = 'black';
                game.ctx.fillRect(game.player.x + 20, game.player.y + 20, 8, 8);
                game.ctx.fillRect(game.player.x + 55, game.player.y + 20, 8, 8);
                
                game.ctx.fillStyle = '#FFA500';
                game.ctx.beginPath();
                game.ctx.moveTo(game.player.x + 20, game.player.y);
                game.ctx.lineTo(game.player.x + 10, game.player.y - 20);
                game.ctx.lineTo(game.player.x + 30, game.player.y - 10);
                game.ctx.fill();
                
                game.ctx.beginPath();
                game.ctx.moveTo(game.player.x + 60, game.player.y);
                game.ctx.lineTo(game.player.x + 70, game.player.y - 20);
                game.ctx.lineTo(game.player.x + 50, game.player.y - 10);
                game.ctx.fill();
            }
            
            if (game.isPaused) {
                game.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                game.ctx.fillRect(0, 0, game.width, game.height);
                game.ctx.font = 'bold 48px Arial';
                game.ctx.fillStyle = 'white';
                game.ctx.textAlign = 'center';
                game.ctx.fillText('ПАУЗА', game.width / 2, game.height / 2);
                game.ctx.font = '24px Arial';
                game.ctx.fillText('Нажмите ПРОБЕЛ для продолжения', game.width / 2, game.height / 2 + 50);
            }
        }
        
        function gameLoop() {
            if (!game.running) return;
            
            updateGame();
            drawGame();
            
            requestAnimationFrame(gameLoop);
        }
        
        // Обработка нажатия клавиш
        document.addEventListener('keydown', function(e) {
            if (!game.running) return;
            
            if ((e.code === 'Space' || e.code === 'ArrowUp') && !game.player.isJumping) {
                game.player.velocityY = game.jumpForce;
                game.player.isJumping = true;
                game.jumpCount++;
                
                playerStats.totalJumps++;
                saveGameData();
            }
            
            if (e.code === 'KeyP') {
                togglePause();
            }
        });
        
        // Обработка кликов по экрану (для мобильных устройств)
        gameCanvas.addEventListener('click', function() {
            if (!game.running) return;
            
            if (!game.player.isJumping) {
                game.player.velocityY = game.jumpForce;
                game.player.isJumping = true;
                game.jumpCount++;
                
                playerStats.totalJumps++;
                saveGameData();
            }
        });
        
        function togglePause() {
            if (!game.running) return;
            
            game.isPaused = !game.isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            if (game.isPaused) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }
        
        function gameOver() {
            game.running = false;
            
            playerStats.totalGames += 1;
            playerStats.totalPoints += game.score;
            
            if (game.score > playerStats.bestScore) {
                playerStats.bestScore = game.score;
            }
            
            const coinsEarned = Math.floor(game.score / 100);
            playerStats.coins += coinsEarned;
            
            saveGameData();
            updateStatsDisplay();
            
            document.getElementById('finalScore').textContent = `Очки: ${game.score}`;
            document.getElementById('finalCoins').textContent = `Заработано монеток: ${coinsEarned}`;
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // ОСНОВНЫЕ ФУНКЦИИ ИГРЫ
        
        function startGame() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            initGame();
            
            game.canvas.focus();
        }
        
        function returnToMenu() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            generateRanking();
            generateSkins();
        }
        
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            initGame();
        }
        
        // ОБРАБОТЧИКИ СОБЫТИЙ
        
        document.getElementById('startGameBtn').addEventListener('click', function() {
            startGame();
        });
        
        document.getElementById('pauseBtn').addEventListener('click', function() {
            togglePause();
        });
        
        document.getElementById('exitGameBtn').addEventListener('click', function() {
            returnToMenu();
        });
        
        document.getElementById('restartBtn').addEventListener('click', function() {
            restartGame();
        });
        
        document.getElementById('menuBtn').addEventListener('click', function() {
            returnToMenu();
        });
        
        // ОБРАБОТЧИК ОТПРАВКИ ОТЗЫВА С TELEGRAM ИНТЕГРАЦИЕЙ
        document.getElementById('feedbackSubmit').addEventListener('click', function() {
            const name = document.getElementById('name').value;
            const message = document.getElementById('message').value;
            const rating = document.getElementById('rating-select').value;
            
            if (!name || !message) {
                showNotification('Пожалуйста, заполните все обязательные поля', 'error');
                return;
            }
            
            if (message.length < 10) {
                showNotification('Отзыв должен содержать минимум 10 символов', 'error');
                return;
            }
            
            // Если игра запущена через Telegram WebApp
            if (isTelegramWebApp && webAppInitialized && Telegram.WebApp) {
                try {
                    // Создаем объект с данными отзыва
                    const feedbackData = {
                        type: 'feedback',
                        name: name,
                        rating: rating,
                        message: message,
                        timestamp: new Date().toISOString(),
                        userId: telegramUser ? telegramUser.id : null,
                        username: telegramUser ? telegramUser.username : null
                    };
                    
                    // Отправляем данные обратно в бота
                    Telegram.WebApp.sendData(JSON.stringify(feedbackData));
                    
                    showNotification('Спасибо за ваш отзыв! Он отправлен разработчику.', 'info');
                    
                    // Закрываем WebApp через 2 секунды
                    setTimeout(() => {
                        Telegram.WebApp.close();
                    }, 2000);
                    
                } catch (error) {
                    console.error('Ошибка отправки отзыва через Telegram:', error);
                    showNotification('Спасибо за отзыв! (Ошибка отправки)', 'info');
                }
            } else {
                // Если не в Telegram WebApp, просто показываем уведомление
                showNotification('Спасибо за ваш отзыв!', 'info');
                
                // Сохраняем отзыв локально (опционально)
                try {
                    const feedbacks = JSON.parse(localStorage.getItem('ispCatsFeedbacks') || '[]');
                    feedbacks.push({
                        name: name,
                        rating: rating,
                        message: message,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('ispCatsFeedbacks', JSON.stringify(feedbacks));
                } catch (e) {
                    console.log('Не удалось сохранить отзыв локально:', e);
                }
            }
            
            // Сброс формы
            document.getElementById('name').value = '';
            document.getElementById('rating-select').value = '3';
            document.getElementById('message').value = '';
            
            // Если есть пользователь Telegram, заполняем имя снова
            if (telegramUser) {
                const telegramName = telegramUser.first_name + 
                                   (telegramUser.last_name ? ' ' + telegramUser.last_name : '');
                document.getElementById('name').value = telegramName;
            }
        });
    </script>
</body>
</html>